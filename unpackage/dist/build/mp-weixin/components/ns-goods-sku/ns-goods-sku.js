(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["components/ns-goods-sku/ns-goods-sku"],{5161:function(i,t,e){"use strict";var o=e("8694"),s=e.n(o);s.a},"62b0":function(i,t,e){"use strict";e.r(t);var o=e("8a42"),s=e.n(o);for(var a in o)"default"!==a&&function(i){e.d(t,i,(function(){return o[i]}))}(a);t["default"]=s.a},"69b7":function(i,t,e){"use strict";e.d(t,"b",(function(){return s})),e.d(t,"c",(function(){return a})),e.d(t,"a",(function(){return o}));var o={uniPopup:function(){return e.e("components/uni-popup/uni-popup").then(e.bind(null,"fa04"))},nsLogin:function(){return Promise.all([e.e("common/vendor"),e.e("components/ns-login/ns-login")]).then(e.bind(null,"b96a"))},myPopupSelect:function(){return e.e("components/my-popup-select/my-popup-select").then(e.bind(null,"4aa2"))}},s=function(){var i=this,t=i.$createElement,e=(i._self._c,"point"==i.type&&i.goodsDetail.type&&1!=i.goodsDetail.type&&2==i.goodsDetail.type&&i.goodsDetail.image?i.$util.img(i.goodsDetail.image):null),o="point"==i.type&&i.goodsDetail.type&&1!=i.goodsDetail.type&&2==i.goodsDetail.type&&!i.goodsDetail.image?i.$util.img("upload/uniapp/point/coupon.png"):null,s="point"==i.type&&i.goodsDetail.type&&1!=i.goodsDetail.type&&3==i.goodsDetail.type&&i.goodsDetail.image?i.$util.img(i.goodsDetail.image):null,a="point"==i.type&&i.goodsDetail.type&&1!=i.goodsDetail.type&&3==i.goodsDetail.type&&!i.goodsDetail.image?i.$util.img("upload/uniapp/point/hongbao.png"):null,r="point"==i.type&&i.goodsDetail.type&&1!=i.goodsDetail.type?null:i.$util.img(i.goodsDetail.sku_image,{size:"mid"}),n="point"==i.type&&1==i.goodsDetail.type&&"0.00"!=i.goodsDetail.exchange_price&&i.goodsDetail.pay_type>0?i.$lang("common.currencySymbol"):null,u=i.__map(i.goodsDetail.goods_spec_format,(function(t,e){var o=i.__get_orig(t),s=1!=i.goodsDetail.luminosity_status?i.__map(t.value,(function(t,e){var o=i.__get_orig(t),s=t.image?i.$util.img(t.image,{size:"small"}):null;return{$orig:o,g5:s}})):null;return{$orig:o,l0:s}}));i.$mp.data=Object.assign({},{$root:{g0:e,g1:o,g2:s,g3:a,g4:r,m0:n,l1:u}})},a=[]},"714a":function(i,t,e){"use strict";var o=e("e6ad"),s=e.n(o);s.a},8694:function(i,t,e){},"8a42":function(i,t,e){"use strict";(function(i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=a(e("a34a")),s=(a(e("c086")),a(e("2009")));function a(i){return i&&i.__esModule?i:{default:i}}function r(i,t,e,o,s,a,r){try{var n=i[a](r),u=n.value}catch(l){return void e(l)}n.done?t(u):Promise.resolve(u).then(o,s)}function n(i){return function(){var t=this,e=arguments;return new Promise((function(o,s){var a=i.apply(t,e);function n(i){r(a,o,s,n,u,"next",i)}function u(i){r(a,o,s,n,u,"throw",i)}n(void 0)}))}}var u=function(){e.e("components/uni-popup/uni-popup-sku").then(function(){return resolve(e("9f36"))}.bind(null,e)).catch(e.oe)},l={name:"ns-goods-sku",components:{uniPopup:u},props:{goodsDetail:{type:Object,default:null},disabled:{type:Boolean,default:!1},pointLimit:{type:[Number,String]},maxBuy:{type:Number,default:0},minBuy:{type:Number,default:0}},data:function(){return{rimless:"",scrollto:"addbtn0",isIphoneX:!1,systemInfo:{},number:1,btnSwitch:!1,type:"",callback:null,skuId:0,pintuanId:0,limitNumber:0,minNumber:0,preview:0,cartNumber:0,leftIndex:0,ball_mirrorIndex:0,cylinder_mirrorIndex:0,axisIndex:0,sumIndex:0,objIndex:0,leftArray:["R","L"],ball_mirrorArray:[],cylinder_mirrorArray:[],ball_mirrorArray_bk:[],cylinder_mirrorArray_bk:[],axisArray:[],sumArray:[],objArray:[],photometric:0,is_wholesaler:s.default.is_wholesaler,myValue:[],nowIndex:0,lastIndex:0,quantity:0,mirrolist:[],sumPrice:0,newballlist:[],buyer_message:""}},mounted:function(){console.log(this.goodsDetail.sku_spec_format,"多规格"),this.isIphoneX=this.$util.uniappIsIPhoneX(),this.systemInfo=i.getSystemInfoSync(),this.getWholesale(this.goodsDetail),0==this.goodsDetail.goods_id&&this.$emit("error")},watch:{pointLimit:function(i,t){this.limitNumber=Number(i)},goodsDetail:function(i,t){this.goodsDetailChange(i),console.error(this.goodsDetail,"更新了一次"),1==this.goodsDetail.rimless&&(this.rimless=this.goodsDetail.rimless,this.getClickGoodsAdd({},1))},minBuy:function(i,t){this.minBuy>1&&(this.number=Number(this.minBuy))}},methods:{goodsDetailChange:function(i,t){if(this.skuId=i.sku_id,console.error(this.goodsDetail.luminosity_status,"luminosity_status"),1!=this.goodsDetail.luminosity_status&&this.setBalllist(),0!=i.photometric||1==i.luminosity_status){for(var e=[],o=.25,s=i.ball_min;s<=i.ball_max;s+=o)o=s<this.goodsDetail.step&&0!=this.goodsDetail.step?.5:.25,e.push((s.toFixed(2)>0?"+":"")+s.toFixed(2));for(var a=[],r=.25,n=i.cylinder_min;n<=i.cylinder_max;n+=r)r=n<this.goodsDetail.step&&0!=this.goodsDetail.step?.5:.25,a.push((n.toFixed(2)>0?"+":"")+n.toFixed(2));for(var u=[],l=0;l<=180;l+=1)u.push(l);var d=[];if(1==this.goodsDetail.a_dd)d=this.goodsDetail.a_dd_data;else for(var c=0;c<=180;c+=1)d.push(c);var h=[];if(1==this.goodsDetail.passage)h=this.goodsDetail.passage_data;else for(var m=0;m<=180;m+=1)h.push(m);this.photometric=i.photometric,this.ball_mirrorArray=e,this.cylinder_mirrorArray=a,this.ball_mirrorArray_bk=e,this.cylinder_mirrorArray_bk=a,this.myValue=[],this.getClickGoodsAdd(),this.axisArray=u,this.sumArray=d,this.objArray=h}},setBalllist:function(){var i=this,t=0,e=0,o=[],s=this.goodsDetail,a=s.ball_min,r=s.ball_max;0==this.mirrolist.length&&(o=this.getList(a,r)),this.mirrolist.forEach((function(s){e=s.ball_min,t=s.ball_max;var a=i.getList(e,t);o=o.concat(a)})),o=Array.from(new Set(o)),o.sort((function(i,t){return i-t})),this.newballlist=o},getSumPrice:function(){var i=0;this.myValue.forEach((function(t){i+=parseFloat(t.discount_price||0)*t.product_num})),this.sumPrice=i},nomove:function(i){},getList:function(){for(var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=[],o=.25,s=i;s<=t;s+=o){o=s<this.goodsDetail.step&&0!=this.goodsDetail.step?.5:.25;var a=s>0?"+"+s:s;a=parseFloat(a).toFixed(2),a>0&&(a="+".concat(a)),e.push(a)}return 0==e.length&&e.push(0),e},setMyPopup:function(i,t,e){var o=this,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.doIndex(i),s=this.myValue[this.nowIndex];var a=s;if(1==this.goodsDetail.luminosity_status){if(!(a.ball_mirrorIndex>=0)&&"cylinder"===t)return this.$util.showToast({title:"先选球镜"});if("ball"==t&&(e=this.newballlist),"cylinder"==t&&null!=s){var r=s.ball_mirrorArray[s.ball_mirrorIndex],n=0,u=0,l=[];return this.mirrolist.forEach((function(i){if(u=i.cylinder_min,n=i.cylinder_max,parseFloat(r)>=parseFloat(i.ball_min)&&parseFloat(r)<=parseFloat(i.ball_max)){a.sku_id=i.sku_id;var t=o.getList(u,n);l=l.concat(t)}})),l=Array.from(new Set(l)),l.sort((function(i,t){return i-t})),s.cylinder_mirrorArray=l,console.log(l,t,"0----------"),this.$refs[t].list=l,void this.$refs[t].open()}}console.log(e,t,"1----------"),this.$refs[t].list=e,"ball"==t&&0===this.$refs[t].list.length&&(this.$refs[t].list=this.ball_mirrorArray_bk),"cylinder"==t&&0===this.$refs[t].list.length&&(this.$refs[t].list=this.cylinder_mirrorArray_bk),this.$refs[t].open()},doIndex:function(i){this.nowIndex=i},getWholesale:function(i){var t=this;return n(o.default.mark((function i(){var e,s;return o.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,t.$api.sendRequest({url:"/api/member/detail",async:!1});case 2:return e=i.sent,0==e.code&&(t.is_wholesaler=e.is_wholesaler),i.next=6,t.$api.sendRequest({url:"/api/goodssku/luminosity_sku",data:{goods_id:t.goodsDetail.goods_id},async:!1});case 6:s=i.sent,delete s.timestamp,t.mirrolist=Object.values(s),t.setBalllist();case 10:case"end":return i.stop()}}),i)})))()},reset:function(){this.ball_mirrorIndex=null,this.cylinder_mirrorIndex=null,this.ball_mirrorArray=this.ball_mirrorArray_bk,this.cylinder_mirrorArray=this.cylinder_mirrorArray_bk},bindPickerChangeF:function(i){this.myValue[this.nowIndex].leftIndex=i.target.value},bindPickerChangeA:function(i){var t=this,e=this.myValue[this.nowIndex];if(e.ball_mirrorIndex=i.target.value,1==this.goodsDetail.luminosity_status)return e.ball_mirrorArray=this.newballlist,e.cylinder_mirrorIndex=null,void this.getSumPrice();var o=e.ball_mirrorArray[e.ball_mirrorIndex],s=[];if(this.cylinder_mirrorArray_bk.forEach((function(i){parseFloat(i)+parseFloat(o)>=parseFloat(t.photometric)&&s.push(i)})),null!=e.cylinder_mirrorIndex){var a=e.cylinder_mirrorArray[e.cylinder_mirrorIndex],r=s.indexOf(a);e.cylinder_mirrorIndex=-1==r?0:r}e.cylinder_mirrorArray=s},bindPickerChangeB:function(i){var t=this,e=this.myValue[this.nowIndex],o=e.cylinder_mirrorArray[i.target.value],s=this.myValue[this.nowIndex].ball_mirrorArray[this.myValue[this.nowIndex].ball_mirrorIndex];if(1==this.goodsDetail.luminosity_status)return this.mirrolist.forEach((function(i,t){i.cylinder_max>=o&&o>=i.cylinder_min&&s>=i.ball_min&&s<=i.ball_max&&(e.discount_price=i.discount_price,e.sku_id=i.sku_id)})),this.myValue[this.nowIndex].cylinder_mirrorIndex=i.target.value,e.cylinder_mirrorIndex=i.target.value,void this.getSumPrice();this.myValue[this.nowIndex].cylinder_mirrorIndex=i.target.value,e.cylinder_mirrorIndex=i.target.value;var a=e.cylinder_mirrorArray[e.cylinder_mirrorIndex],r=[];if(this.ball_mirrorArray_bk.forEach((function(i){parseFloat(i)+parseFloat(a)>=parseFloat(t.photometric)&&r.push(i)})),e.ball_mirrorIndex){var n=e.ball_mirrorArray[e.ball_mirrorIndex],u=r.indexOf(n);e.ball_mirrorIndex=-1==u?0:u}e.ball_mirrorArray=r},bindPickerChangeC:function(i){this.myValue[this.nowIndex].axisIndex=i.target.value,this.axisIndex=i.target.value},bindPickerChangeD:function(i){this.myValue[this.nowIndex].sumIndex=i.target.value,this.sumIndex=i.target.value},bindPickerChangeE:function(i){this.myValue[this.nowIndex].objIndex=i.target.value,this.objIndex=i.target.value},show:function(i,t){this.callback=t,this.$refs.skuPopup.open(t),this.type=i,this.skuId=this.goodsDetail.sku_id,this.preview=this.goodsDetail.preview||0,"pintuan"==this.type&&this.goodsDetail.pintuan_id?this.limitNumber=this.goodsDetail.buy_num:"groupbuy"==this.type&&this.goodsDetail.groupbuy_id?(this.number=this.goodsDetail.buy_num,this.minNumber=this.goodsDetail.buy_num):"bargain"==this.type&&this.goodsDetail.bargain_id?(this.number=1,this.minNumber=1):"wholesale_join_cart"!=this.type&&"wholesale_buy_now"!=this.type||!this.goodsDetail.wholesale_sku_id||(this.number=this.goodsDetail.min_num,this.minNumber=this.goodsDetail.min_num),"join_cart"==this.type&&(this.getCartData(),this.$forceUpdate())},hide:function(){this.$refs.skuPopup.close()},change:function(i,t){if(!this.disabled){this.btnSwitch=!1,this.skuId=i;for(var e=0;e<this.goodsDetail.goods_spec_format.length;e++)for(var o=this.goodsDetail.goods_spec_format[e],s=0;s<o.value.length;s++)t==this.goodsDetail.goods_spec_format[e].value[s].spec_id&&(this.goodsDetail.goods_spec_format[e].value[s].selected=!1);this.goodsDetail.pintuan_id?this.getPintuanGoodsSkuInfo():this.goodsDetail.groupbuy_id?this.getGroupbuyGoodsSkuInfo():this.goodsDetail.bargain_id?this.getBargainGoodsSkuInfo():this.goodsDetail.seckill_id?this.getSeckillGoodsSkuInfo():this.goodsDetail.topic_id?this.getTopicsGoodsSkuInfo():this.goodsDetail.exchange_id?this.getPointGoodsSkuInfo():this.goodsDetail.wholesale_sku_id?this.getWholeSaleGoodsSkuInfo():this.getGoodsSkuInfo()}},getGoodsSkuInfo:function(){var i=this,t=this;this.$api.sendRequest({url:"/api/goodssku/info",data:{sku_id:this.skuId},success:function(e){console.log(e.sku_images,"goodsSkuDetail.sku_images图片");var o=e.data;if(null!=o){o.unit=o.unit||"件";var s=o;s.sku_spec_format&&(s.sku_spec_format=JSON.parse(o.sku_spec_format)),1==s.promotion_type&&(s.discountTimeMachine=t.$util.countDown(s.end_time-e.timestamp)),1==s.promotion_type&&s.discountTimeMachine?s.show_price=s.discount_price:s.show_price=s.price,s.goods_spec_format&&(s.goods_spec_format=JSON.parse(s.goods_spec_format)),t.btnSwitch=!1,t.$emit("refresh",s)}else i.$util.redirectTo("/pages/index/index/index",{},"reLaunch")},fail:function(t){i.btnSwitch=!1,i.$util.redirectTo("/pages/index/index/index",{},"reLaunch")}})},getPintuanGoodsSkuInfo:function(){var i=this;this.$api.sendRequest({url:"/pintuan/api/goods/info",data:{sku_id:this.skuId,pintuan_id:this.goodsDetail.pintuan_id},success:function(t){var e=t.data;if(null!=e){if("again"==e.type)return i.skuId=e.sku_id,void i.getPintuanGoodsSkuInfo();e.unit=e.unit||"件",i.goodsSkuDetail=e,i.dealData(),i.goodsSkuDetail.show_price=0==i.goodsDetail.group_id?i.goodsSkuDetail.promotion_price:i.goodsSkuDetail.pintuan_price,i.goodsSkuDetail.save_price=i.goodsSkuDetail.price-i.goodsSkuDetail.show_price>0?(i.goodsSkuDetail.price-i.goodsSkuDetail.show_price).toFixed(2):0,i.goodsSkuDetail.end_time-t.timestamp>0?i.goodsSkuDetail.timeMachine=i.$util.countDown(i.goodsSkuDetail.end_time-t.timestamp):(i.$util.showToast({title:"活动已结束"}),setTimeout((function(){i.$util.redirectTo("/pages/goods/detail/detail",{sku_id:i.goodsSkuDetail.sku_id},"redirectTo")}),1e3)),i.btnSwitch=!1,i.$emit("refresh",i.goodsSkuDetail)}else i.$util.redirectTo("/pages/index/index/index",{},"reLaunch")},fail:function(t){i.btnSwitch=!1,i.$util.redirectTo("/pages/index/index/index",{},"reLaunch")}})},getBargainGoodsSkuInfo:function(){var i=this;this.$api.sendRequest({url:"/bargain/api/goods/info",data:{sku_id:this.skuId,bargain_id:this.goodsDetail.bargain_id},success:function(t){var e=t.data;if(null!=e){if("again"==e.type)return i.skuId=e.sku_id,void i.getBargainGoodsSkuInfo();e.unit=e.unit||"件",i.goodsSkuDetail=e,i.dealData(),i.goodsSkuDetail.show_price=i.goodsDetail.bargain_id>0?i.goodsSkuDetail.floor_price:i.goodsSkuDetail.price,i.goodsSkuDetail.stock=i.goodsSkuDetail.bargain_stock,i.goodsSkuDetail.save_price=i.goodsSkuDetail.price-i.goodsSkuDetail.show_price>0?(i.goodsSkuDetail.price-i.goodsSkuDetail.show_price).toFixed(2):0,i.goodsSkuDetail.end_time-t.timestamp>0?i.goodsSkuDetail.timeMachine=i.$util.countDown(i.goodsSkuDetail.end_time-t.timestamp):(i.$util.showToast({title:"活动已结束"}),setTimeout((function(){i.$util.redirectTo("/pages/goods/detail/detail",{sku_id:i.goodsSkuDetail.sku_id},"redirectTo")}),1e3)),i.btnSwitch=!1,i.$emit("refresh",i.goodsSkuDetail)}else i.$util.redirectTo("/pages/index/index/index",{},"reLaunch")},fail:function(t){i.btnSwitch=!1,i.$util.redirectTo("/pages/index/index/index",{},"reLaunch")}})},getTopicsGoodsSkuInfo:function(){var i=this;this.$api.sendRequest({url:"/topic/api/topicgoods/info",data:{sku_id:this.skuId,topic_id:this.goodsDetail.topic_id},success:function(t){var e=t.data;if(null!=e){if("again"==e.type)return i.skuId=e.sku_id,void i.getTopicsGoodsSkuInfo();e.unit=e.unit||"件",i.goodsSkuDetail=e.goods_sku_detail,i.dealData(),i.goodsSkuDetail.show_price=i.goodsDetail.topic_id>0?i.goodsSkuDetail.topic_price:i.goodsSkuDetail.price,i.goodsSkuDetail.save_price=i.goodsSkuDetail.price-i.goodsSkuDetail.show_price>0?(i.goodsSkuDetail.price-i.goodsSkuDetail.show_price).toFixed(2):0,i.goodsSkuDetail.end_time-t.timestamp>0?i.goodsSkuDetail.timeMachine=i.$util.countDown(i.goodsSkuDetail.end_time-t.timestamp):(i.$util.showToast({title:"活动已结束"}),setTimeout((function(){i.$util.redirectTo("/pages/goods/detail/detail",{sku_id:i.goodsSkuDetail.sku_id},"redirectTo")}),1e3)),i.btnSwitch=!1,i.$emit("refresh",i.goodsSkuDetail)}else i.$util.redirectTo("/pages/index/index/index",{},"reLaunch")},fail:function(t){i.btnSwitch=!1,i.$util.redirectTo("/pages/index/index/index",{},"reLaunch")}})},getGroupbuyGoodsSkuInfo:function(){var i=this;this.$api.sendRequest({url:"/groupbuy/api/goods/info",data:{sku_id:this.skuId,groupbuy_id:this.goodsDetail.groupbuy_id},success:function(t){var e=t.data;null!=e?(e.unit=e.unit||"件",i.goodsSkuDetail=e,i.dealData(),i.goodsSkuDetail.show_price=i.goodsDetail.groupbuy_price,i.goodsSkuDetail.save_price=i.goodsSkuDetail.price-i.goodsSkuDetail.show_price>0?(i.goodsSkuDetail.price-i.goodsSkuDetail.show_price).toFixed(2):0,i.goodsSkuDetail.end_time-t.timestamp>0?i.goodsSkuDetail.timeMachine=i.$util.countDown(i.goodsSkuDetail.end_time-t.timestamp):(i.$util.showToast({title:"活动已结束"}),setTimeout((function(){i.$util.redirectTo("/pages/goods/detail/detail",{sku_id:i.goodsSkuDetail.sku_id},"redirectTo")}),1e3)),i.btnSwitch=!1,i.$emit("refresh",i.goodsSkuDetail)):i.$util.redirectTo("/pages/index/index/index",{},"reLaunch")},fail:function(t){i.btnSwitch=!1,i.$util.redirectTo("/pages/index/index/index",{},"reLaunch")}})},getSeckillGoodsSkuInfo:function(){var i=this;this.$api.sendRequest({url:"/seckill/api/seckillgoods/info",data:{sku_id:this.skuId,seckill_id:this.goodsDetail.seckill_id},success:function(t){var e=t.data;if(null!=e){if("again"==e.type)return i.skuId=e.sku_id,void i.getSeckillGoodsSkuInfo();e.unit=e.unit||"件",i.goodsSkuDetail=e.goods_sku_detail,i.dealData(),i.goodsSkuDetail.show_price=i.goodsSkuDetail.seckill_price,i.goodsSkuDetail.price-i.goodsSkuDetail.show_price>0&&(i.goodsSkuDetail.price-i.goodsSkuDetail.show_price).toFixed(2),i.goodsSkuDetail.end_time-t.timestamp>0?i.goodsSkuDetail.timeMachine=i.$util.countDown(i.goodsSkuDetail.end_time-t.timestamp):(i.$util.showToast({title:"活动已结束"}),setTimeout((function(){i.$util.redirectTo("/pages/goods/detail/detail",{sku_id:i.goodsSkuDetail.sku_id},"redirectTo")}),1e3)),i.btnSwitch=!1,i.$emit("refresh",i.goodsSkuDetail)}else i.$util.redirectTo("/pages/index/index/index",{},"reLaunch")},fail:function(t){i.btnSwitch=!1,i.$util.redirectTo("/pages/index/index/index",{},"reLaunch")}})},getPointGoodsSkuInfo:function(){var i=this;this.$api.sendRequest({url:"/pointexchange/api/goods/info",data:{sku_id:this.skuId,exchange_id:this.goodsDetail.exchange_id},success:function(t){var e=t.data;if(null!=e){if("again"==e.type)return i.skuId=e.sku_id,void i.getPointGoodsSkuInfo();e.unit=e.unit||"件",i.goodsSkuDetail=e,i.dealData(),i.btnSwitch=!1,i.$emit("refresh",i.goodsSkuDetail)}else i.$util.redirectTo("/promotionpages/point/list/list",{},"redirectTo")},fail:function(t){i.btnSwitch=!1,i.$util.redirectTo("/pages/index/index/index",{},"reLaunch")}})},getWholeSaleGoodsSkuInfo:function(){var i=this;this.$api.sendRequest({url:"/wholesale/api/goods/info",data:{sku_id:this.skuId},success:function(t){var e=t.data;null!=e?(e.unit=e.unit||"件",i.goodsSkuDetail=e,i.number=i.goodsSkuDetail.min_num,i.minNumber=i.goodsSkuDetail.min_num,i.dealData(),i.btnSwitch=!1,i.$emit("refresh",i.goodsSkuDetail)):i.$util.redirectTo("/pages/index/index/index",{},"reLaunch")},fail:function(t){i.btnSwitch=!1,i.$util.redirectTo("/pages/index/index/index",{},"reLaunch")}})},getClickGoodsAdd:function(i,t){this.myValue.push({objIndex:void 0,product_num:1,sumIndex:void 0,axisIndex:void 0,cylinder_mirrorIndex:void 0,ball_mirrorIndex:void 0,leftIndex:t||0,axisValue:0,cylinder_mirrorArray:this.cylinder_mirrorArray_bk,ball_mirrorArray:this.ball_mirrorArray_bk}),this.scrollto="addbtn".concat(this.myValue.length)},removeTap:function(i){this.myValue.splice(i,1)},dealData:function(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.goodsSkuDetail;if(i.sku_images?i.sku_images=i.sku_images.split(","):i.sku_images=[],i.goods_spec_format&&i.goods_image&&(i.goods_image=i.goods_image.split(","),i.sku_images=i.sku_images.concat(i.goods_image)),i.sku_spec_format&&(i.sku_spec_format=JSON.parse(i.sku_spec_format)),i.goods_attr_format){var t=JSON.parse(i.goods_attr_format);i.goods_attr_format=this.$util.unique(t,"attr_id");for(var e=0;e<i.goods_attr_format.length;e++)for(var o=0;o<t.length;o++)i.goods_attr_format[e].attr_id==t[o].attr_id&&i.goods_attr_format[e].attr_value_id!=t[o].attr_value_id&&(i.goods_attr_format[e].attr_value_name+="、"+t[o].attr_value_name)}i.goods_spec_format&&(i.goods_spec_format=JSON.parse(i.goods_spec_format)),this.goodsDetail.unit=this.goodsDetail.unit||"件",this.keyInput(!0),this.$langConfig.title(i.goods_name)},changeNum:function(i){if(0!=this.goodsDetail.stock){var t=this.goodsDetail.stock,e=1;if(this.maxBuy>0&&this.maxBuy<t&&(t=this.maxBuy),this.maxBuy>0&&this.goodsDetail.purchased_num>0&&(t=this.maxBuy-this.goodsDetail.purchased_num),this.minBuy>1&&(e=this.minBuy),"pintuan"==this.type&&this.goodsDetail.pintuan_id?t=this.goodsDetail.buy_num>this.goodsDetail.stock?this.goodsDetail.stock:this.goodsDetail.buy_num:"groupbuy"==this.type&&this.goodsDetail.groupbuy_id?(t=(this.goodsDetail.buy_num,this.goodsDetail.stock,this.goodsDetail.stock),e=this.goodsDetail.buy_num):"seckill"==this.type&&this.goodsDetail.seckill_id&&this.goodsDetail.num>0&&this.goodsDetail.num<this.goodsDetail.stock?t=this.goodsDetail.num:"bargain"==this.type&&this.goodsDetail.bargain_id&&(t=1),"+"==i)if(this.number<t)this.number++;else{if(this.maxBuy>0&&this.goodsDetail.purchased_num>0)return void this.$util.showToast({title:"该商品每人限购"+this.maxBuy+this.goodsDetail.unit+"，您已购买了"+this.goodsDetail.purchased_num+this.goodsDetail.unit});if(this.maxBuy>0&&this.cartNumber>0&&this.cartNumber+this.number>this.maxBuy){var o=this.maxBuy-this.cartNumber;return void(o>0?this.$util.showToast({title:"该商品每人限购"+this.maxBuy+this.goodsDetail.unit+"，购物车已加入了"+this.cartNumber+this.goodsDetail.unit+"，还能购买"+o+this.goodsDetail.unit}):this.$util.showToast({title:"该商品每人限购"+this.maxBuy+this.goodsDetail.unit}))}if("seckill"==this.type&&this.goodsDetail.seckill_id&&this.goodsDetail.num>0)return void this.$util.showToast({title:"该商品每人限购"+this.goodsDetail.num+this.goodsDetail.unit})}else if("-"==i){if(!(this.number>e))return void(this.minBuy>1&&this.$util.showToast({title:"该商品"+this.minBuy+this.goodsDetail.unit+"起售"}));this.number-=1}this.number>this.limitNumber&&this.limitNumber&&(this.number=this.limitNumber)}},blur:function(){var i=this;if(this.number||(this.number=0),this.number>this.limitNumber&&this.limitNumber&&(this.number=this.limitNumber),this.number<this.minNumber&&this.minNumber&&(this.number=this.minNumber),this.maxBuy>0&&this.number>this.maxBuy&&(this.number=this.maxBuy),this.maxBuy>0&&this.goodsDetail.purchased_num>0){var t=this.maxBuy-this.goodsDetail.purchased_num;this.number>t&&(this.number=t)}this.number<this.minBuy&&this.minBuy>0&&(this.number=this.minBuy);var e=parseInt(this.number);this.number=0,setTimeout((function(){i.number=e}),0)},keyInput:function(i,t){var e=this;setTimeout((function(){var o=e.goodsDetail.stock;0!=e.goodsDetail.stock?(i&&0==e.number.length&&(e.number=1),i&&(e.number<=0||isNaN(e.number))&&(e.number=1),"pintuan"==e.type&&e.goodsDetail.pintuan_id&&e.number>e.goodsDetail.buy_num||"groupbuy"==e.type&&e.goodsDetail.groupbuy_id&&e.number<e.goodsDetail.buy_num?e.number=e.goodsDetail.buy_num:"seckill"==e.type&&e.goodsDetail.seckill_id&&e.goodsDetail.max_buy>0&&e.number>e.goodsDetail.max_buy?e.number=e.goodsDetail.max_buy:"bargain"==e.type&&e.goodsDetail.bargain_id?e.number=1:e.number>o&&(e.number=o),e.minBuy>1&&e.number<e.minBuy&&(e.number=e.minBuy),i&&(e.number=parseInt(e.number)),t&&t()):e.number=0}),0)},confirm:function(){var t=this;i.removeStorageSync("delivery"),this.preview?this.$util.showToast({title:"预览商品无法购买"}):this.checkParam()&&(i.getStorageSync("token")?this.keyInput(!0,(function(){if(0!=t.goodsDetail.stock)if(0!=t.number.length&&0!=t.number){if(t.number>t.goodsDetail.stock)t.$util.showToast({title:"库存不足"});else if(t.maxBuy>0&&t.goodsDetail.purchased_num>0&&t.number>t.maxBuy-t.goodsDetail.purchased_num)t.$util.showToast({title:"该商品每人限购"+t.maxBuy+t.goodsDetail.unit+"，您已购买了"+t.goodsDetail.purchased_num+t.goodsDetail.unit});else if(t.maxBuy>0&&t.cartNumber>0&&t.cartNumber+t.number>t.maxBuy){var i=t.maxBuy-t.cartNumber;i>0?t.$util.showToast({title:"该商品每人限购"+t.maxBuy+t.goodsDetail.unit+"，购物车已加入了"+t.cartNumber+t.goodsDetail.unit+"，还能购买"+i+t.goodsDetail.unit}):t.$util.showToast({title:"该商品每人限购"+t.maxBuy+t.goodsDetail.unit})}else if(!t.btnSwitch){t.btnSwitch=!0;t.myValue.forEach((function(i){i.leftIndex,i.cylinder_mirrorIndex,i.ball_mirrorIndex,i.axisIndex,i.objIndex,i.sumIndex,i.product_num,i.sku_id}));var e=[];t.myValue.map((function(i){e.push({eye:0==i.leftIndex?"右眼":"左眼",passage:t.objArray[i.objIndex],a_dd:t.sumArray[i.sumIndex],num:i.product_num,ball_mirror:i.ball_mirrorArray[i.ball_mirrorIndex],cylinder_mirror:i.cylinder_mirrorArray[i.cylinder_mirrorIndex],axis:i.axisValue,sku_id:i.sku_id})})),"join_cart"==t.type&&t.postJoinCart(e),"buy_now"==t.type&&t.postBuyNow(),"seckill"==t.type&&t.postSeckill(),"pintuan"==t.type&&t.postPintuan(),"topic"==t.type&&t.postTopic(),"groupbuy"==t.type&&t.postGroupBuy(),"presale"==t.type&&t.postPresale(),"bargain"==t.type&&t.postBargain(),"point"==t.type&&t.postPoint(),"wholesale_join_cart"==t.type&&t.postPfJoin(),"wholesale_buy_now"==t.type&&t.postPfBuy(),t.myValue=[],t.getClickGoodsAdd(),console.error(t.goodsDetail.rimless,"rimless"),1==t.goodsDetail.rimless&&(t.rimless=t.goodsDetail.rimless,t.getClickGoodsAdd({},1))}}else t.$util.showToast({title:"购买数量不能为0"});else t.$util.showToast({title:"商品已售罄"})})):this.$refs.login.open())},checkParam:function(){var i=this,t=!0;return 0==this.goodsDetail.photometric&&1!=this.goodsDetail.luminosity_status||this.myValue.forEach((function(e){return void 0==e.ball_mirrorArray[e.ball_mirrorIndex]?(i.$util.showToast({title:"请选择球镜"}),void(t=!1)):void 0==e.cylinder_mirrorArray[e.cylinder_mirrorIndex]?(i.$util.showToast({title:"请选择柱镜"}),void(t=!1)):void 0==e.sumIndex&&1==i.goodsDetail.a_dd?(i.$util.showToast({title:"请选择ADD"}),void(t=!1)):void 0==e.objIndex&&1==i.goodsDetail.passage?(i.$util.showToast({title:"请选择通道"}),void(t=!1)):(i.quantity+=e.product_num,i.goodsDetail.stock<=e.product_num?(i.$util.showToast({title:"请不要大于库存数量"}),void(t=!1)):void 0)})),t},postJoinCart:function(i){var t=this,e=this.number,o=0!=this.goodsDetail.photometric||1==this.goodsDetail.luminosity_status?{sku_id:this.skuId,site_id:this.goodsDetail.site_id,list:JSON.stringify(i),buyer_message:this.buyer_message,rimless:this.rimless}:{site_id:this.goodsDetail.site_id,sku_id:this.skuId,ball_mirror:null!=this.ball_mirrorIndex?this.ball_mirrorArray[this.ball_mirrorIndex]:0,cylinder_mirror:null!=this.cylinder_mirrorIndex?this.cylinder_mirrorArray[this.cylinder_mirrorIndex]:0,axis:this.axisValue,a_dd_data:null!=this.sumIndex?this.sumIndex[this.sumIndex]:0,passage_data:null!=this.objIndex?this.objIndex[this.objIndex]:0,num:e,buyer_message:this.buyer_message,rimless:this.rimless};this.$api.sendRequest({url:"/api/cart/add",data:o,success:function(i){var e=i.data;e>0&&(t.$util.showToast({title:"加入购物车成功"}),t.callback&&t.callback()),t.$refs.skuPopup.close(),t.btnSwitch=!1},fail:function(i){t.$refs.skuPopup.close(),t.btnSwitch=!1}})},postBuyNow:function(){var t=this,e={sku_id:this.skuId,num:this.number,ball_mirror:null!=this.ball_mirrorIndex?this.ball_mirrorArray[this.ball_mirrorIndex]:0,cylinder_mirror:null!=this.cylinder_mirrorIndex?this.cylinder_mirrorArray[this.cylinder_mirrorIndex]:0,axis:null!=this.axisIndex?this.axisArray[this.axisIndex]:0};i.setStorage({key:"orderCreateData",data:e,success:function(){t.$util.redirectTo("/pages/order/payment/payment"),t.btnSwitch=!1}})},postSeckill:function(){var t=this,e={seckill_id:this.goodsDetail.seckill_id,num:this.number,sku_id:this.skuId};i.setStorage({key:"seckillOrderCreateData",data:e,success:function(){t.$util.redirectTo("/promotionpages/seckill/payment/payment"),t.btnSwitch=!1}})},postPintuan:function(){var t=this,e={pintuan_goods_id:this.goodsDetail.id,group_id:this.goodsDetail.group_id,num:this.number};i.setStorage({key:"pintuanOrderCreateData",data:e,success:function(){t.$util.redirectTo("/promotionpages/pintuan/payment/payment"),t.btnSwitch=!1}})},postTopic:function(){var t=this,e={topic_goods_id:this.goodsDetail.id,num:this.number};i.setStorage({key:"topicOrderCreateData",data:e,success:function(){t.$util.redirectTo("/promotionpages/topics/payment/payment"),t.btnSwitch=!1}})},postGroupBuy:function(){var t=this,e={groupbuy_id:this.goodsDetail.groupbuy_id,sku_id:this.skuId,num:this.number};i.setStorage({key:"groupbuyOrderCreateData",data:e,success:function(){t.$util.redirectTo("/promotionpages/groupbuy/payment/payment"),t.btnSwitch=!1}})},postPresale:function(){var t=this,e={presale_id:this.goodsDetail.presale_id,sku_id:this.skuId,num:this.number};i.setStorage({key:"presaleOrderCreateData",data:e,success:function(){t.$util.redirectTo("/promotionpages/presale/payment/payment"),t.btnSwitch=!1}})},postBargain:function(){var i=this;this.$api.sendRequest({url:"/bargain/api/bargain/launch",data:{id:this.goodsDetail.id},success:function(t){i.btnSwitch=!1,0==t.code?i.$util.redirectTo("/promotionpages/bargain/launch/launch",{id:t.data},"redirectTo"):i.$util.showToast({title:t.message})}})},postPoint:function(){var t=this,e={id:this.goodsDetail.exchange_id,sku_id:this.skuId,num:this.number};i.setStorage({key:"exchangeOrderCreateData",data:e,success:function(){t.$util.redirectTo("/promotionpages/point/payment/payment"),t.btnSwitch=!1}})},postPfJoin:function(){var i=this;this.$api.sendRequest({url:"/wholesale/api/cart/add",data:{site_id:this.goodsDetail.site_id,sku_id:this.skuId,num:this.number},success:function(t){var e=t.data;e>0&&(i.$util.showToast({title:"加入进货单成功"}),i.callback&&i.callback(),i.$store.dispatch("getWholeSaleNumber")),i.$refs.skuPopup.close(),i.btnSwitch=!1},fail:function(t){i.$refs.skuPopup.close(),i.btnSwitch=!1}})},postPfBuy:function(){var t=this,e={sku_id:this.skuId,num:this.number};i.setStorage({key:"wholesaleOrderCreateData",data:e,success:function(){t.$util.redirectTo("/promotionpages/wholesale/payment/payment"),t.btnSwitch=!1}})},closeSkuPopup:function(){this.$refs.skuPopup.close()},imgError:function(){this.goodsDetail.sku_image=this.$util.getDefaultImage().default_goods_img,this.$forceUpdate()},valueImgError:function(i,t){this.goodsDetail.goods_spec_format[i].value[t].image=this.$util.getDefaultImage().default_goods_img,this.$forceUpdate()},getCartData:function(){var i=this;this.$api.sendRequest({url:"/api/cart/goodslists",success:function(t){if(t.code>=0)for(var e=t.data,o=0;o<e.length;o++)if(e[o].sku_id==i.goodsDetail.sku_id){i.cartNumber=e[o].num;break}}})}}};t.default=l}).call(this,e("543d")["default"])},e60b:function(i,t,e){"use strict";e.r(t);var o=e("69b7"),s=e("62b0");for(var a in s)"default"!==a&&function(i){e.d(t,i,(function(){return s[i]}))}(a);e("714a"),e("5161");var r,n=e("f0c5"),u=Object(n["a"])(s["default"],o["b"],o["c"],!1,null,"6f701f7f",null,!1,o["a"],r);t["default"]=u.exports},e6ad:function(i,t,e){}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'components/ns-goods-sku/ns-goods-sku-create-component',
    {
        'components/ns-goods-sku/ns-goods-sku-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('543d')['createComponent'](__webpack_require__("e60b"))
        })
    },
    [['components/ns-goods-sku/ns-goods-sku-create-component']]
]);
