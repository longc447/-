(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/goods/cart/cart"],{"28ee":function(t,a,n){"use strict";var e=n("843f"),i=n.n(e);i.a},"2c78":function(t,a,n){},"2d495":function(t,a,n){"use strict";var e=n("2c78"),i=n.n(e);i.a},"2fa9":function(t,a,n){"use strict";n.r(a);var e=n("dc5b"),i=n.n(e);for(var o in e)"default"!==o&&function(t){n.d(a,t,(function(){return e[t]}))}(o);a["default"]=i.a},4422:function(t,a,n){"use strict";n.d(a,"b",(function(){return i})),n.d(a,"c",(function(){return o})),n.d(a,"a",(function(){return e}));var e={uniNumberBox:function(){return n.e("components/uni-number-box/uni-number-box").then(n.bind(null,"9b6d"))},loadingCover:function(){return n.e("components/loading-cover/loading-cover").then(n.bind(null,"a197"))},diyBottomNav:function(){return n.e("components/diy-bottom-nav/diy-bottom-nav").then(n.bind(null,"8c8e"))},nsLogin:function(){return Promise.all([n.e("common/vendor"),n.e("components/ns-login/ns-login")]).then(n.bind(null,"b96a"))}},i=function(){var t=this,a=t.$createElement,n=(t._self._c,t.isAction?t.$lang("complete"):null),e=t.isAction?null:t.$lang("edit"),i=t.hasData?t.__map(t.cartData,(function(a,n){var e=t.__get_orig(a),i=t.$lang("del"),o=t.__map(a.cartList,(function(a,n){var e=t.__get_orig(a),i=1==a.promotion_type?t.$lang("common.currencySymbol"):null,o=1==a.promotion_type?t.$util.img("upload/uniapp/index/discount.png"):null,c=1!=a.promotion_type?t.$lang("common.currencySymbol"):null,s=t.initNum(a);return{$orig:e,m2:i,g0:o,m3:c,m4:s}}));return{$orig:e,m5:i,l0:o}})):null,o=t.$lang("common.currencySymbol"),c=t.hasData&&t.invalidGoods.length?t.__map(t.invalidGoods,(function(a,n){var e=t.__get_orig(a),i=t.$util.img(a.sku_image,{size:"mid"});return{$orig:e,g1:i}})):null,s=t.hasData?null:t.$util.img("upload/uniapp/common-empty.png"),r=t.hasData?null:t.$lang("emptyTips"),u=t.hasData?t.$lang("allElection"):null,l=t.hasData?t.$lang("total"):null,d=t.hasData?t.$lang("common.currencySymbol"):null,h=t.hasData&&t.isAction?t.$lang("del"):null,f=t.hasData&&!t.isAction&&0!=t.totalCount?t.$lang("settlement"):null,m=t.hasData&&!t.isAction&&0==t.totalCount?t.$lang("settlement"):null;t._isMounted||(t.e0=function(a){return t.$util.redirectTo("/pages/index/index/index",{},"reLaunch")}),t.$mp.data=Object.assign({},{$root:{m0:n,m1:e,l1:i,m6:o,l2:c,g2:s,m7:r,m8:u,m9:l,m10:d,m11:h,m12:f,m13:m}})},o=[]},8065:function(t,a,n){"use strict";n.r(a);var e=n("4422"),i=n("2fa9");for(var o in i)"default"!==o&&function(t){n.d(a,t,(function(){return i[t]}))}(o);n("28ee"),n("2d495");var c,s=n("f0c5"),r=Object(s["a"])(i["default"],e["b"],e["c"],!1,null,"5df1bb3b",null,!1,e["a"],c);a["default"]=r.exports},"843f":function(t,a,n){},b27c:function(t,a,n){"use strict";(function(t){n("f871");e(n("66fd"));var a=e(n("8065"));function e(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=n,t(a.default)}).call(this,n("543d")["createPage"])},dc5b:function(t,a,n){"use strict";(function(t){Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var e=c(n("a34a")),i=c(n("46da")),o=c(n("a5a8"));function c(t){return t&&t.__esModule?t:{default:t}}function s(t,a,n,e,i,o,c){try{var s=t[o](c),r=s.value}catch(u){return void n(u)}s.done?a(r):Promise.resolve(r).then(e,i)}function r(t){return function(){var a=this,n=arguments;return new Promise((function(e,i){var o=t.apply(a,n);function c(t){s(o,e,i,c,r,"next",t)}function r(t){s(o,e,i,c,r,"throw",t)}c(void 0)}))}}var u=function(){Promise.all([n.e("common/vendor"),n.e("components/ns-goods-recommend/ns-goods-recommend")]).then(function(){return resolve(n("2ce6"))}.bind(null,n)).catch(n.oe)},l=function(){n.e("components/uni-number-box/uni-number-box").then(function(){return resolve(n("9b6d"))}.bind(null,n)).catch(n.oe)},d=function(){n.e("components/diy-bottom-nav/diy-bottom-nav").then(function(){return resolve(n("8c8e"))}.bind(null,n)).catch(n.oe)},h=function(){n.e("components/toTop/toTop").then(function(){return resolve(n("9b08"))}.bind(null,n)).catch(n.oe)},f={components:{nsGoodsRecommend:u,uniNumberBox:l,diyBottomNav:d,toTop:h},mixins:[i.default,o.default],data:function(){return{token:"",cartData:[],checkAll:!0,totalPrice:"0.00",totalCount:0,modifyFlag:!1,isSub:!1,invalidGoods:[],isIphoneX:!1,cartBottom:"56px",isAction:!1,startX:"",endX:"",is_wholesaler:0,styleIPhone12:!1}},onLoad:function(){var a=this;t.hideTabBar(),this.token=t.getStorageSync("token"),console.log(this.token,"token"),t.getSystemInfo({success:function(t){"iPhone 12"==t.model.substring(0,9)&&(a.styleIPhone12=!0,console.log(t.model))}})},onShow:function(){var a=this;return r(e.default.mark((function n(){var i;return e.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(a.$langConfig.refresh(),!t.getStorageSync("token")){n.next=6;break}return n.next=4,a.$api.sendRequest({url:"/api/member/detail",async:!1});case 4:i=n.sent,0==i.code&&(console.log(i),a.is_wholesaler=i.is_wholesaler);case 6:t.getStorageSync("token")?a.getCartData():(a.token="",a.cartData=[],a.calculationTotalPrice()),a.isIphoneX=a.$util.uniappIsIPhoneX(),a.$util.uniappIsIPhone11()&&(a.cartBottom="90px");case 9:case"end":return n.stop()}}),n)})))()},onReady:function(){t.getStorageSync("token")||this.$refs.loadingCover&&this.$refs.loadingCover.hide()},computed:{hasData:function(){return this.cartData.length>0||this.invalidGoods.length>0},storeToken:function(){return this.$store.state.token}},watch:{storeToken:function(t,a){this.getCartData()}},methods:{initNum:function(t){var a=t.max_buy>0&&t.max_buy<t.stock?t.max_buy:t.stock;return a=0==a?1:a,t.num>a?a:t.num},getCartData:function(){var t=this;this.$api.sendRequest({url:"/api/cart/goodslists",success:function(a){a.code>=0?a.data.length?t.handleCartData(a.data):t.cartData=[]:t.token="",t.$refs.loadingCover&&t.$refs.loadingCover.hide()},fail:function(a){t.$refs.loadingCover&&t.$refs.loadingCover.hide()}})},handleCartData:function(t){var a=this;this.invalidGoods=[],this.cartData=[];var n={};t.forEach((function(t,e){1==t.goods_state&&1==t.verify_state&&0!=t.shop_status?t.min_buy>0&&t.min_buy>t.stock?a.invalidGoods.push(t):(t.checked=!0,t.edit=!1,void 0!=n["site_"+t.site_id]?n["site_"+t.site_id].cartList.push(t):n["site_"+t.site_id]={siteId:t.site_id,siteName:t.site_name,edit:!1,checked:!0,cartList:[t]}):a.invalidGoods.push(t)})),this.cartData=[],Object.keys(n).forEach((function(t){a.cartData.push(n[t])})),this.calculationTotalPrice(),this.cartData.length&&this.cartData.forEach((function(t){t.cartList.forEach((function(t){}))})),this.invalidGoods.length&&this.invalidGoods.forEach((function(t){t.sku_spec_format?t.sku_spec_format=JSON.parse(t.sku_spec_format):t.sku_spec_format=[]}))},singleElection:function(t,a){this.cartData[t].cartList[a].checked=!this.cartData[t].cartList[a].checked,this.calculationTotalPrice()},siteAllElection:function(t,a){this.cartData[a].checked=t,this.cartData[a].cartList.forEach((function(a){a.checked=t})),this.calculationTotalPrice()},allElection:function(t){var a=this;this.checkAll="boolean"==typeof t?t:!this.checkAll,this.cartData.length&&this.cartData.forEach((function(t){t.checked=a.checkAll,t.cartList.forEach((function(t){t.checked=a.checkAll}))})),this.calculationTotalPrice()},calculationTotalPrice:function(){if(this.cartData.length){var t=0,a=0,n=0;this.cartData.forEach((function(e){var i=0;e.cartList.forEach((function(n){n.checked&&(i+=1,a+=parseInt(n.num),t+=n.discount_price*n.num)})),e.cartList.length==i?(e.checked=!0,n+=1):e.checked=!1})),this.totalPrice=t.toFixed(2),this.totalCount=a,this.checkAll=this.cartData.length==n}else this.totalPrice="0.00",this.totalCount=0;this.modifyFlag=!1},deleteCart:function(a,n,e){var i=this,o=[];if("all"==a)for(var c=0;c<this.cartData.length;c++)for(var s=0;s<this.cartData[c].cartList.length;s++)this.cartData[c].cartList[s].checked&&o.push(this.cartData[c].cartList[s].cart_id);else o.push(this.cartData[n].cartList[e].cart_id);0!=o.length?t.showModal({title:"提示",content:"确定要删除这些商品吗？",success:function(t){t.confirm&&(o=o.toString(),i.$api.sendRequest({url:"/api/cart/delete",data:{cart_id:o},success:function(t){if(t.code>=0){if("all"==a)for(var o=0;o<i.cartData.length;o++){for(var c=0;c<i.cartData[o].cartList.length;c++){var s=i.cartData[o].cartList[c];s.checked&&(i.cartData[o].cartList.splice(c,1),c=-1)}0==i.cartData[o].cartList.length&&(i.cartData.splice(o,1),o=-1)}else i.cartData[n].cartList.splice(e,1),0==i.cartData[n].cartList.length&&i.cartData.splice(n,1);i.calculationTotalPrice(),i.getCartNumber()}else i.$util.showToast({title:t.message})}}))}}):this.$util.showToast({title:"请选择要删除的商品"})},cartNumChange:function(t,a){var n=this;if(!isNaN(t)){var e=this.cartData[a.siteIndex].cartList[a.cartIndex],i=e.max_buy>0&&e.max_buy<e.stock?e.max_buy:e.stock,o=e.min_buy>0?e.min_buy:1;t>i&&(t=i),t<o&&(t=o),this.modifyFlag=!0,this.$api.sendRequest({url:"/api/cart/edit",data:{num:t,cart_id:this.cartData[a.siteIndex].cartList[a.cartIndex].cart_id},success:function(e){e.code>=0?(n.cartData[a.siteIndex].cartList[a.cartIndex].num=t,n.calculationTotalPrice(),n.getCartNumber()):n.$util.showToast({title:e.message})}})}},settlement:function(){var a=this;if(this.totalCount>0){var n=[];if(this.cartData.forEach((function(t){t.cartList.forEach((function(t){t.checked&&n.push(t.cart_id)}))})),this.isSub)return;this.isSub=!0,t.setStorage({key:"orderCreateData",data:{cart_ids:n.toString()},success:function(){a.$util.redirectTo("/pages/order/payment/payment"),a.isSub=!1}})}},clearInvalidGoods:function(){var a=this;t.showModal({title:"提示",content:"确定要清空这些商品吗？",success:function(t){if(t.confirm){var n=[];a.invalidGoods.forEach((function(t){n.push(t.cart_id)})),n.length&&a.$api.sendRequest({url:"/api/cart/delete",data:{cart_id:n.toString()},success:function(t){t.code>=0?(a.invalidGoods=[],a.getCartNumber()):a.$util.showToast({title:t.message})}})}}})},imgError:function(t,a){this.cartData[t].cartList[a].sku_image=this.$util.getDefaultImage().default_goods_img,this.$forceUpdate()},toGoodsDetail:function(t){this.$util.redirectTo("/pages/goods/detail/detail",{sku_id:t.sku_id})},getCartNumber:function(){t.getStorageSync("token")&&(this.$store.dispatch("getCartNumber"),this.resetEditStatus())},goodsLimit:function(t,a,n){var e=this.cartData[a].cartList[n];"plus"==t.type?e.max_buy>0&&e.max_buy<e.stock?this.$util.showToast({title:"该商品每人限购"+e.max_buy+"件"}):this.$util.showToast({title:"库存不足"}):this.$util.showToast({title:"最少购买"+t.value+"件"})},toLogin:function(){this.$refs.login.open()},touchS:function(t){this.startX=t.touches[0].clientX},touchE:function(t,a){this.endX=t.changedTouches[0].clientX;var n=this.startX-this.endX;n>50?a.edit=!0:n<0&&(a.edit=!1),this.$forceUpdate()},resetEditStatus:function(){for(var t=0;t<this.cartData.length;t++)for(var a=0;a<this.cartData[t].cartList.length;a++)this.cartData[t].cartList[a].edit=!1;this.$forceUpdate()},changeAction:function(){this.isAction=!this.isAction,this.resetEditStatus()}}};a.default=f}).call(this,n("543d")["default"])}},[["b27c","common/runtime","common/vendor"]]]);