(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/goods/cart/cart"],{"0f5e":function(t,a,e){"use strict";var n=e("9449"),i=e.n(n);i.a},"3a81":function(t,a,e){"use strict";e.r(a);var n=e("c2d0"),i=e.n(n);for(var o in n)"default"!==o&&function(t){e.d(a,t,(function(){return n[t]}))}(o);a["default"]=i.a},"624d":function(t,a,e){"use strict";var n=e("9e73"),i=e.n(n);i.a},9449:function(t,a,e){},"9e73":function(t,a,e){},acd9:function(t,a,e){"use strict";e.d(a,"b",(function(){return i})),e.d(a,"c",(function(){return o})),e.d(a,"a",(function(){return n}));var n={uniNumberBox:function(){return e.e("components/uni-number-box/uni-number-box").then(e.bind(null,"2fe7"))},loadingCover:function(){return e.e("components/loading-cover/loading-cover").then(e.bind(null,"f410"))},diyBottomNav:function(){return e.e("components/diy-bottom-nav/diy-bottom-nav").then(e.bind(null,"7ed3"))},nsLogin:function(){return Promise.all([e.e("common/vendor"),e.e("components/ns-login/ns-login")]).then(e.bind(null,"ec11"))}},i=function(){var t=this,a=t.$createElement,e=(t._self._c,t.isAction?t.$lang("complete"):null),n=t.isAction?null:t.$lang("edit"),i=t.hasData?t.__map(t.cartData,(function(a,e){var n=t.__get_orig(a),i=t.$lang("del"),o=t.__map(a.cartList,(function(a,e){var n=t.__get_orig(a),i=t.$util.img(a.sku_image,{size:"mid"}),o=1==a.promotion_type?t.$lang("common.currencySymbol"):null,c=1==a.promotion_type?t.$util.img("upload/uniapp/index/discount.png"):null,s=1!=a.promotion_type?t.$lang("common.currencySymbol"):null,r=t.initNum(a);return{$orig:n,g0:i,m2:o,g1:c,m3:s,m4:r}}));return{$orig:n,m5:i,l0:o}})):null,o=t.$lang("common.currencySymbol"),c=t.hasData&&t.invalidGoods.length?t.__map(t.invalidGoods,(function(a,e){var n=t.__get_orig(a),i=t.$util.img(a.sku_image,{size:"mid"});return{$orig:n,g2:i}})):null,s=t.hasData?null:t.$util.img("upload/uniapp/common-empty.png"),r=t.hasData?null:t.$lang("emptyTips"),u=t.hasData?t.$lang("allElection"):null,l=t.hasData?t.$lang("total"):null,d=t.hasData?t.$lang("common.currencySymbol"):null,h=t.hasData&&t.isAction?t.$lang("del"):null,f=t.hasData&&!t.isAction&&0!=t.totalCount?t.$lang("settlement"):null,m=t.hasData&&!t.isAction&&0==t.totalCount?t.$lang("settlement"):null;t._isMounted||(t.e0=function(a){return t.$util.redirectTo("/pages/index/index/index",{},"reLaunch")}),t.$mp.data=Object.assign({},{$root:{m0:e,m1:n,l1:i,m6:o,l2:c,g3:s,m7:r,m8:u,m9:l,m10:d,m11:h,m12:f,m13:m}})},o=[]},bc82:function(t,a,e){"use strict";e.r(a);var n=e("acd9"),i=e("3a81");for(var o in i)"default"!==o&&function(t){e.d(a,t,(function(){return i[t]}))}(o);e("0f5e"),e("624d");var c,s=e("f0c5"),r=Object(s["a"])(i["default"],n["b"],n["c"],!1,null,"8c100306",null,!1,n["a"],c);a["default"]=r.exports},c2d0:function(t,a,e){"use strict";(function(t){Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var n=c(e("a34a")),i=c(e("6756")),o=c(e("faec"));function c(t){return t&&t.__esModule?t:{default:t}}function s(t,a,e,n,i,o,c){try{var s=t[o](c),r=s.value}catch(u){return void e(u)}s.done?a(r):Promise.resolve(r).then(n,i)}function r(t){return function(){var a=this,e=arguments;return new Promise((function(n,i){var o=t.apply(a,e);function c(t){s(o,n,i,c,r,"next",t)}function r(t){s(o,n,i,c,r,"throw",t)}c(void 0)}))}}var u=function(){Promise.all([e.e("common/vendor"),e.e("components/ns-goods-recommend/ns-goods-recommend")]).then(function(){return resolve(e("6136"))}.bind(null,e)).catch(e.oe)},l=function(){e.e("components/uni-number-box/uni-number-box").then(function(){return resolve(e("2fe7"))}.bind(null,e)).catch(e.oe)},d=function(){e.e("components/diy-bottom-nav/diy-bottom-nav").then(function(){return resolve(e("7ed3"))}.bind(null,e)).catch(e.oe)},h=function(){e.e("components/toTop/toTop").then(function(){return resolve(e("fe2d"))}.bind(null,e)).catch(e.oe)},f={components:{nsGoodsRecommend:u,uniNumberBox:l,diyBottomNav:d,toTop:h},mixins:[i.default,o.default],data:function(){return{token:"",cartData:[],checkAll:!0,totalPrice:"0.00",totalCount:0,modifyFlag:!1,isSub:!1,invalidGoods:[],isIphoneX:!1,cartBottom:"56px",isAction:!1,startX:"",endX:"",is_wholesaler:0,styleIPhone12:!1}},onLoad:function(){var a=this;t.hideTabBar(),t.getSystemInfo({success:function(t){"iPhone 12"==t.model.substring(0,9)&&(a.styleIPhone12=!0,console.log(t.model))}})},onShow:function(){var a=this;return r(n.default.mark((function e(){var i;return n.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a.$langConfig.refresh(),!t.getStorageSync("token")){e.next=6;break}return e.next=4,a.$api.sendRequest({url:"/api/member/detail",async:!1});case 4:i=e.sent,0==i.code&&(console.log(i),a.is_wholesaler=i.is_wholesaler);case 6:t.getStorageSync("token")?a.getCartData():(a.token="",a.cartData=[],a.calculationTotalPrice()),a.isIphoneX=a.$util.uniappIsIPhoneX(),a.$util.uniappIsIPhone11()&&(a.cartBottom="90px");case 9:case"end":return e.stop()}}),e)})))()},onReady:function(){t.getStorageSync("token")||this.$refs.loadingCover&&this.$refs.loadingCover.hide()},computed:{hasData:function(){return this.cartData.length>0||this.invalidGoods.length>0},storeToken:function(){return this.$store.state.token}},watch:{storeToken:function(t,a){this.getCartData()}},methods:{initNum:function(t){var a=t.max_buy>0&&t.max_buy<t.stock?t.max_buy:t.stock;return a=0==a?1:a,t.num>a?a:t.num},getCartData:function(){var a=this;this.$api.sendRequest({url:"/api/cart/goodslists",success:function(e){e.code>=0?(a.token=t.getStorageSync("token"),e.data.length?a.handleCartData(e.data):a.cartData=[]):a.token="",a.$refs.loadingCover&&a.$refs.loadingCover.hide()},fail:function(t){a.$refs.loadingCover&&a.$refs.loadingCover.hide()}})},handleCartData:function(t){var a=this;this.invalidGoods=[],this.cartData=[];var e={};t.forEach((function(t,n){1==t.goods_state&&1==t.verify_state&&0!=t.shop_status?t.min_buy>0&&t.min_buy>t.stock?a.invalidGoods.push(t):(t.checked=!0,t.edit=!1,void 0!=e["site_"+t.site_id]?e["site_"+t.site_id].cartList.push(t):e["site_"+t.site_id]={siteId:t.site_id,siteName:t.site_name,edit:!1,checked:!0,cartList:[t]}):a.invalidGoods.push(t)})),this.cartData=[],Object.keys(e).forEach((function(t){a.cartData.push(e[t])})),this.calculationTotalPrice(),this.cartData.length&&this.cartData.forEach((function(t){t.cartList.forEach((function(t){t.sku_spec_format?t.sku_spec_format=JSON.parse(t.sku_spec_format):t.sku_spec_format=[]}))})),this.invalidGoods.length&&this.invalidGoods.forEach((function(t){t.sku_spec_format?t.sku_spec_format=JSON.parse(t.sku_spec_format):t.sku_spec_format=[]}))},singleElection:function(t,a){this.cartData[t].cartList[a].checked=!this.cartData[t].cartList[a].checked,this.calculationTotalPrice()},siteAllElection:function(t,a){this.cartData[a].checked=t,this.cartData[a].cartList.forEach((function(a){a.checked=t})),this.calculationTotalPrice()},allElection:function(t){var a=this;this.checkAll="boolean"==typeof t?t:!this.checkAll,this.cartData.length&&this.cartData.forEach((function(t){t.checked=a.checkAll,t.cartList.forEach((function(t){t.checked=a.checkAll}))})),this.calculationTotalPrice()},calculationTotalPrice:function(){if(this.cartData.length){var t=0,a=0,e=0;this.cartData.forEach((function(n){var i=0;n.cartList.forEach((function(e){e.checked&&(i+=1,a+=parseInt(e.num),t+=e.discount_price*e.num)})),n.cartList.length==i?(n.checked=!0,e+=1):n.checked=!1})),this.totalPrice=t.toFixed(2),this.totalCount=a,this.checkAll=this.cartData.length==e}else this.totalPrice="0.00",this.totalCount=0;this.modifyFlag=!1},deleteCart:function(a,e,n){var i=this,o=[];if("all"==a)for(var c=0;c<this.cartData.length;c++)for(var s=0;s<this.cartData[c].cartList.length;s++)this.cartData[c].cartList[s].checked&&o.push(this.cartData[c].cartList[s].cart_id);else o.push(this.cartData[e].cartList[n].cart_id);0!=o.length?t.showModal({title:"提示",content:"确定要删除这些商品吗？",success:function(t){t.confirm&&(o=o.toString(),i.$api.sendRequest({url:"/api/cart/delete",data:{cart_id:o},success:function(t){if(t.code>=0){if("all"==a)for(var o=0;o<i.cartData.length;o++){for(var c=0;c<i.cartData[o].cartList.length;c++){var s=i.cartData[o].cartList[c];s.checked&&(i.cartData[o].cartList.splice(c,1),c=-1)}0==i.cartData[o].cartList.length&&(i.cartData.splice(o,1),o=-1)}else i.cartData[e].cartList.splice(n,1),0==i.cartData[e].cartList.length&&i.cartData.splice(e,1);i.calculationTotalPrice(),i.getCartNumber()}else i.$util.showToast({title:t.message})}}))}}):this.$util.showToast({title:"请选择要删除的商品"})},cartNumChange:function(t,a){var e=this;if(!isNaN(t)){var n=this.cartData[a.siteIndex].cartList[a.cartIndex],i=n.max_buy>0&&n.max_buy<n.stock?n.max_buy:n.stock,o=n.min_buy>0?n.min_buy:1;t>i&&(t=i),t<o&&(t=o),this.modifyFlag=!0,this.$api.sendRequest({url:"/api/cart/edit",data:{num:t,cart_id:this.cartData[a.siteIndex].cartList[a.cartIndex].cart_id},success:function(n){n.code>=0?(e.cartData[a.siteIndex].cartList[a.cartIndex].num=t,e.calculationTotalPrice(),e.getCartNumber()):e.$util.showToast({title:n.message})}})}},settlement:function(){var a=this;if(this.totalCount>0){var e=[];if(this.cartData.forEach((function(t){t.cartList.forEach((function(t){t.checked&&e.push(t.cart_id)}))})),this.isSub)return;this.isSub=!0,t.setStorage({key:"orderCreateData",data:{cart_ids:e.toString()},success:function(){a.$util.redirectTo("/pages/order/payment/payment"),a.isSub=!1}})}},clearInvalidGoods:function(){var a=this;t.showModal({title:"提示",content:"确定要清空这些商品吗？",success:function(t){if(t.confirm){var e=[];a.invalidGoods.forEach((function(t){e.push(t.cart_id)})),e.length&&a.$api.sendRequest({url:"/api/cart/delete",data:{cart_id:e.toString()},success:function(t){t.code>=0?(a.invalidGoods=[],a.getCartNumber()):a.$util.showToast({title:t.message})}})}}})},imgError:function(t,a){this.cartData[t].cartList[a].sku_image=this.$util.getDefaultImage().default_goods_img,this.$forceUpdate()},toGoodsDetail:function(t){this.$util.redirectTo("/pages/goods/detail/detail",{sku_id:t.sku_id})},getCartNumber:function(){t.getStorageSync("token")&&(this.$store.dispatch("getCartNumber"),this.resetEditStatus())},goodsLimit:function(t,a,e){var n=this.cartData[a].cartList[e];"plus"==t.type?n.max_buy>0&&n.max_buy<n.stock?this.$util.showToast({title:"该商品每人限购"+n.max_buy+"件"}):this.$util.showToast({title:"库存不足"}):this.$util.showToast({title:"最少购买"+t.value+"件"})},toLogin:function(){this.$refs.login.open()},touchS:function(t){this.startX=t.touches[0].clientX},touchE:function(t,a){this.endX=t.changedTouches[0].clientX;var e=this.startX-this.endX;e>50?a.edit=!0:e<0&&(a.edit=!1),this.$forceUpdate()},resetEditStatus:function(){for(var t=0;t<this.cartData.length;t++)for(var a=0;a<this.cartData[t].cartList.length;a++)this.cartData[t].cartList[a].edit=!1;this.$forceUpdate()},changeAction:function(){this.isAction=!this.isAction,this.resetEditStatus()}}};a.default=f}).call(this,e("543d")["default"])},d6a0:function(t,a,e){"use strict";(function(t){e("c5b8");n(e("66fd"));var a=n(e("bc82"));function n(t){return t&&t.__esModule?t:{default:t}}t(a.default)}).call(this,e("543d")["createPage"])}},[["d6a0","common/runtime","common/vendor"]]]);