(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["promotionpages/game/turntable/turntable"],{"0ebe":function(t,e,n){},"27ff":function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=o(n("a5a8"));function o(t){return t&&t.__esModule?t:{default:t}}var r=function(){n.e("components/uni-popup/uni-popup").then(function(){return resolve(n("fa04"))}.bind(null,n)).catch(n.oe)},a=function(){Promise.all([n.e("common/vendor"),n.e("promotionpages/components/l-time/l-time")]).then(function(){return resolve(n("697d"))}.bind(null,n)).catch(n.oe)},s={components:{uniPopup:r,LTime:a},data:function(){return{token:null,isClick:!1,currentIndex:-1,maxRing:6,currentRing:1,speed:300,timer:null,id:0,gameInfo:{award:[{award_img:"",award_name:""}],surplus_num:""},award:[],noAward:[],resultIndex:0,result:{is_winning:1},point:0,animate:!1,scrollTimer:null,siteId:0}},onLoad:function(t){t.id&&(this.id=t.id),t.site_id&&(this.siteId=t.site_id),this.getGameInfo()},onShow:function(){var e=this;this.$langConfig.refresh(),this.$store.dispatch("getAddonIsexit").then((function(n){n.turntable?t.getStorageSync("token")&&(e.getMemberPointInfo(),e.token=t.getStorageSync("token")):(e.$util.showToast({title:"幸运抽奖未开启",mask:!0}),setTimeout((function(){e.$util.redirectTo("/pages/index/index/index",{},"redirectTo")}),1e3))}))},mixins:[i.default],computed:{storeToken:function(){return this.$store.state.token}},watch:{storeToken:function(e,n){e&&(this.token=t.getStorageSync("token"),this.getMemberPointInfo(),this.getGameInfo())}},methods:{redirectToRecord:function(t){this.$util.redirectTo("/promotionpages/game/record/record",{id:t})},getMemberPointInfo:function(){var t=this;this.$api.sendRequest({url:"/api/memberaccount/info",data:{account_type:"point"},success:function(e){e.data&&(t.point=parseInt(e.data.point))}})},lottery:function(){var e=this;t.getStorageSync("token")?1==this.gameInfo.status&&(this.gameInfo.surplus_num<=0?this.$util.showToast({title:"您的抽奖次数已用完"}):this.gameInfo.points>0&&this.point<this.gameInfo.points?this.$util.showToast({title:"积分不足"}):this.isClick||(this.isClick=!0,this.currentIndex=0,this.currentRing=1,this.speed=300,this.timer=setInterval(this.startRoll,this.speed),this.$api.sendRequest({url:"/turntable/api/turntable/lottery",data:{id:this.id,site_id:this.siteId},success:function(t){if(t.code>=0){if(e.result=t.data,t.data.is_winning)e.resultIndex=e.$util.inArray(t.data.award_id,e.award);else{var n=e.noAward.length;e.resultIndex=e.noAward[Math.floor(Math.random()*n)]}e.point-=e.gameInfo.points,e.gameInfo.surplus_num-=1}else e.$util.showToast({title:t.message})},fail:function(t){e.resultIndex=e.$util.inArray(-1,e.award)}}))):this.$refs.login.open("/promotionpages/game/turntable/turntable?id="+this.id+"&site_id="+this.siteId)},getGameInfo:function(){var t=this;this.$api.sendRequest({url:"/turntable/api/turntable/info",data:{id:this.id,site_id:this.siteId},success:function(e){e.code>=0&&e.data?(t.gameInfo=e.data,e.data.award.forEach((function(e,n){t.award.push(e.award_id),e.award_id<0&&t.noAward.push(n)})),t.$refs.loadingCover&&t.$refs.loadingCover.hide(),t.gameInfo.is_show_winner&&t.gameInfo.draw_record.length>6&&(t.scrollTimer=setInterval(t.scrollRecord,2e3))):(t.$util.showToast({title:"未获取到活动信息！"}),setTimeout((function(){t.$util.redirectTo("/pages/index/index/index",{},"reLaunch")}),1e3))},fail:function(e){t.$util.showToast({title:"未获取到活动信息！"}),setTimeout((function(){t.$util.redirectTo("/pages/index/index/index",{},"reLaunch")}),1e3)}})},startRoll:function(){if(this.speed>50&&(this.speed-=50),this.currentRing>=this.maxRing-1&&this.speed<700&&(this.speed+=100),this.currentRing==this.maxRing&&this.currentIndex==this.resultIndex)return clearInterval(this.timer),void this.showResult();7==this.currentIndex?(this.currentRing+=1,this.currentIndex=0):this.currentIndex+=1,clearInterval(this.timer),this.timer=setTimeout(this.startRoll,this.speed)},showResult:function(){this.$refs.resultPopup.open()},closePopup:function(){this.isClick=!1,this.currentIndex=-1,this.$refs.resultPopup.close()},openRulePopup:function(){this.$refs.rulePopup.open()},closeRulePopup:function(){this.$refs.rulePopup.close()},scrollRecord:function(){var t=this;this.animate=!0,setTimeout((function(){t.gameInfo.draw_record.push(t.gameInfo.draw_record[0]),t.gameInfo.draw_record.shift(),t.animate=!1}),1e3)}},filters:{cover:function(t){return t.substr(0,1)+"******"+t.substr(-1)}},onHide:function(){clearInterval(this.scrollTimer)}};e.default=s}).call(this,n("543d")["default"])},"326d":function(t,e,n){"use strict";(function(t){n("f871");i(n("66fd"));var e=i(n("58c4"));function i(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=n,t(e.default)}).call(this,n("543d")["createPage"])},"58c4":function(t,e,n){"use strict";n.r(e);var i=n("a155"),o=n("6a01");for(var r in o)"default"!==r&&function(t){n.d(e,t,(function(){return o[t]}))}(r);n("7565"),n("f670");var a,s=n("f0c5"),u=Object(s["a"])(o["default"],i["b"],i["c"],!1,null,"4e3488a4",null,!1,i["a"],a);e["default"]=u.exports},"6a01":function(t,e,n){"use strict";n.r(e);var i=n("27ff"),o=n.n(i);for(var r in i)"default"!==r&&function(t){n.d(e,t,(function(){return i[t]}))}(r);e["default"]=o.a},7565:function(t,e,n){"use strict";var i=n("0ebe"),o=n.n(i);o.a},a155:function(t,e,n){"use strict";n.d(e,"b",(function(){return o})),n.d(e,"c",(function(){return r})),n.d(e,"a",(function(){return i}));var i={uniPopup:function(){return n.e("components/uni-popup/uni-popup").then(n.bind(null,"fa04"))},loadingCover:function(){return n.e("components/loading-cover/loading-cover").then(n.bind(null,"a197"))},nsLogin:function(){return Promise.all([n.e("common/vendor"),n.e("components/ns-login/ns-login")]).then(n.bind(null,"b96a"))}},o=function(){var t=this,e=t.$createElement,n=(t._self._c,t.$util.img("upload/uniapp/game/turntable_head.png")),i=t.$util.img("upload/uniapp/turntable_bg.png"),o=t.__map(t.gameInfo.award,(function(e,n){var i=t.__get_orig(e),o=t.$util.img(e.award_img);return{$orig:i,g2:o}})),r=t.gameInfo.is_show_winner&&t.gameInfo.draw_record.length?t.__map(t.gameInfo.draw_record,(function(e,n){var i=t.__get_orig(e),o=t._f("cover")(e.member_nick_name);return{$orig:i,f0:o}})):null,a=t.result.is_winning?t.$util.img(t.gameInfo.award[t.resultIndex].award_img):null,s=t.result.is_winning?t.$util.img("upload/uniapp/game/result_yes.png"):null,u=t.result.is_winning?null:t.$util.img("upload/uniapp/game/result_look.png"),l=t.result.is_winning?null:t.$util.img("upload/uniapp/game/result_no.png"),d=t.$util.img("upload/uniapp/game/rule_head.png"),c=t.$util.timeStampTurnTime(t.gameInfo.start_time),f=t.$util.timeStampTurnTime(t.gameInfo.end_time);t.$mp.data=Object.assign({},{$root:{g0:n,g1:i,l0:o,l1:r,g3:a,g4:s,g5:u,g6:l,g7:d,g8:c,g9:f}})},r=[]},e191:function(t,e,n){},f670:function(t,e,n){"use strict";var i=n("e191"),o=n.n(i);o.a}},[["326d","common/runtime","common/vendor"]]]);